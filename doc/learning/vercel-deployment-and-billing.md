# Vercel デプロイと顧客請求ガイド

## 目次

1. [Vercel vs Cloudflare Pages 比較](#vercel-vs-cloudflare-pages-比較)
2. [Vercel の料金体系](#vercel-の料金体系)
3. [プロジェクト数の制限](#プロジェクト数の制限)
4. [複数顧客への提供方法](#複数顧客への提供方法)
5. [料金計算例](#料金計算例)
6. [顧客への請求方法](#顧客への請求方法)
7. [デプロイ手順](#デプロイ手順)
8. [推奨アプローチ](#推奨アプローチ)

---

## Vercel vs Cloudflare Pages 比較

### 概要

| 項目 | Vercel | Cloudflare Pages |
|---|---|---|
| **開発元** | Vercel (Next.js の開発元) | Cloudflare |
| **Next.js サポート** | ✅ 完全対応（公式） | ✅ 対応（コミュニティ） |
| **主な強み** | Next.js に最適化 | CDN ネットワーク、低価格 |
| **料金** | 無料枠あり | 無料枠あり（より寛容） |

### Next.js との相性

#### Vercel（推奨）

**メリット**:
- ✅ **Next.js に完全最適化** - 開発元なので100%サポート
- ✅ **ゼロコンフィグ** - `git push` だけでデプロイ完了
- ✅ **Edge Functions 完全対応** - Next.js の全機能が動く
- ✅ **Image Optimization** - Next.js Image の最適化が自動
- ✅ **Incremental Static Regeneration (ISR)** - 完全サポート
- ✅ **App Router 完全対応** - Next.js 13+ の新機能も完全動作

**デメリット**:
- ❌ 無料枠の制限が厳しめ
- ❌ 商用利用は有料プラン必須

#### Cloudflare Pages

**メリット**:
- ✅ **無料枠が寛容** - 帯域幅・ビルド時間が多い
- ✅ **グローバル CDN** - 世界中に300以上のデータセンター
- ✅ **低レイテンシ** - 高速なグローバル配信
- ✅ **DDoS 保護** - Cloudflare のセキュリティ機能

**デメリット**:
- ❌ Next.js の一部機能に制限あり
- ❌ Image Optimization が制限される
- ❌ **Prisma が動かない可能性**（Edge Runtime のみサポート）
- ❌ セットアップがやや複雑

### このプロジェクト（日報アプリ）での結論

**Vercel を推奨**

**理由**:
1. Next.js + Prisma の組み合わせが確実に動く
2. セットアップが超簡単（15分で完了）
3. 顧客への月額料金に含めれば問題なし
4. 将来的な拡張性が高い

---

## Vercel の料金体系

### プラン比較

| 項目 | Hobby（無料） | Pro | Enterprise |
|---|---|---|---|
| **月額料金** | $0 | $20/月 | カスタム |
| **プロジェクト数** | ✅ 無制限 | ✅ 無制限 | ✅ 無制限 |
| **デプロイ回数** | ✅ 無制限 | ✅ 無制限 | ✅ 無制限 |
| **帯域幅** | 100GB/月 | 1TB/月 | カスタム |
| **ビルド時間** | 6,000分/月 | 無制限 | 無制限 |
| **チームメンバー** | 1人 | 無制限 | 無制限 |
| **同時ビルド** | 1つ | 12個 | カスタム |
| **画像最適化** | 1,000枚/月 | 5,000枚/月 | カスタム |
| **Edge Functions** | 100,000リクエスト/日 | 1,000,000リクエスト/日 | カスタム |
| **サポート** | コミュニティ | 優先サポート | 専任サポート |
| **商用利用** | ❌ 不可 | ✅ 可 | ✅ 可 |

### 重要な制限

#### Hobby プラン（無料）

```
✅ 使用可能な用途:
- 個人的なプロジェクト
- 学習・実験
- デモ環境
- オープンソースプロジェクト

❌ 使用不可な用途:
- 商用利用（顧客へ有料でアプリを提供）
- 会社のビジネスで使用
- 広告収入を得る
```

**つまり**: 顧客にアプリを提供する場合、**Pro プラン（$20/月）が必須**

---

## プロジェクト数の制限

### 無料プランでも無制限！

**Vercel Hobby プラン（無料）でも無制限にプロジェクトを作成できます。**

```
無料プランで作成できるプロジェクト数: ∞（無制限）
デプロイ回数: ∞（無制限）
```

ただし、以下の制限があります：

1. **帯域幅**: 100GB/月（全プロジェクト合計）
2. **ビルド時間**: 6,000分/月（全プロジェクト合計）
3. **商用利用**: 不可

### 実例

```bash
# 無料プランでも以下のように複数プロジェクトを作成可能

プロジェクト1: daily-report-demo
プロジェクト2: daily-report-test
プロジェクト3: daily-report-staging
プロジェクト4: my-portfolio
プロジェクト5: blog-app
...

すべて無料で作成・デプロイ可能！
```

---

## 複数顧客への提供方法

複数の顧客にアプリを提供する場合、以下の3つのオプションがあります。

### オプション1: 各顧客に Pro アカウント（推奨）

```
顧客A: Vercel Pro ($20/月)
顧客B: Vercel Pro ($20/月)
顧客C: Vercel Pro ($20/月)
顧客D: Vercel Pro ($20/月)
顧客E: Vercel Pro ($20/月)

合計: $100/月（約 ¥15,000/月）
```

#### メリット

- ✅ **セキュリティが高い** - 顧客ごとに完全に分離
- ✅ **スケーラビリティ** - 顧客が増えても問題なし
- ✅ **責任の分離** - 顧客が自分で管理できる
- ✅ **独立した環境変数** - 環境変数が混ざらない
- ✅ **独立した帯域幅** - 顧客Aの使用量が顧客Bに影響しない

#### デメリット

- 顧客数が増えるとコストが増加（$20/月 x 顧客数）

#### 実装方法

```bash
# ステップ1: 顧客AにVercelアカウントを作成してもらう
# （または、あなたが代理で作成）

# ステップ2: あなたが顧客Aのアカウントに招待される
# 顧客Aのアカウント → Settings → Members → Invite

# ステップ3: 顧客Aのアカウントでデプロイ
npx vercel --scope customer-a-account

# ステップ4: 顧客AがVercel Proに支払い
# （または、あなたが代理で支払って請求）
```

### オプション2: 1つの Pro アカウントで複数プロジェクト

```
あなたのアカウント: Vercel Pro ($20/月)
├── 顧客A用プロジェクト
├── 顧客B用プロジェクト
├── 顧客C用プロジェクト
├── 顧客D用プロジェクト
└── 顧客E用プロジェクト

合計: $20/月（約 ¥3,000/月）のみ
```

#### メリット

- ✅ **コストが低い** - 顧客数に関わらず $20/月
- ✅ **一元管理が簡単** - 1つのアカウントで全て管理

#### デメリット

- ❌ **セキュリティリスク** - 全顧客が同じアカウント
- ❌ **顧客が自分で管理できない**
- ❌ **環境変数の管理が複雑** - 顧客間で混ざる可能性
- ❌ **帯域幅を共有** - 1TB/月を全顧客で共有（制限を超えやすい）
- ❌ **ビルド時間の競合** - 同時ビルド制限（12個まで）

#### 実装方法

```bash
# あなたのVercelアカウントで複数プロジェクトを作成

# 顧客A用
cd customer-a-daily-report
npx vercel --prod

# 顧客B用
cd customer-b-daily-report
npx vercel --prod

# 顧客C用
cd customer-c-daily-report
npx vercel --prod
```

### オプション3: Vercel Teams プラン

```
Vercel Teams: $20/月（1席目） + $20/月（追加メンバー）

あなたのTeamsアカウント
├── 顧客A用プロジェクト
├── 顧客B用プロジェクト
└── 顧客C用プロジェクト

メンバー:
- あなた（$20/月）
- 開発者2（$20/月）
- 開発者3（$20/月）

合計: $60/月
```

#### メリット

- ✅ チームでの協業が簡単
- ✅ 複数の開発者で管理

#### デメリット

- メンバーごとに $20/月

---

## 料金計算例

### 例1: 顧客3社の場合

#### オプション1: 各顧客にProアカウント（推奨）

```
【コスト】
Vercel: $20 x 3社 = $60/月（約 ¥9,000/月）
Supabase: $25 x 3社 = $75/月（約 ¥11,250/月）
合計: $135/月（約 ¥20,250/月）

【顧客への請求】
顧客A: ¥20,000/月
├── Vercel Pro: ¥3,000
├── Supabase Pro: ¥3,750
├── サポート・保守: ¥10,000
└── あなたの利益: ¥3,250

顧客B: ¥20,000/月
顧客C: ¥20,000/月

【収支】
収入: ¥20,000 x 3 = ¥60,000/月
支出: ¥20,250/月
利益: ¥39,750/月
```

#### オプション2: 1つのProアカウントで管理

```
【コスト】
Vercel: $20/月（約 ¥3,000/月）
Supabase: $25 x 3社 = $75/月（約 ¥11,250/月）
合計: $95/月（約 ¥14,250/月）

【顧客への請求】
顧客A: ¥15,000/月
├── インフラ費: ¥5,000
├── サポート・保守: ¥7,000
└── あなたの利益: ¥3,000

顧客B: ¥15,000/月
顧客C: ¥15,000/月

【収支】
収入: ¥15,000 x 3 = ¥45,000/月
支出: ¥14,250/月
利益: ¥30,750/月
```

### 例2: 顧客10社の場合

#### オプション1: 各顧客にProアカウント（推奨）

```
【コスト】
Vercel: $20 x 10 = $200/月（約 ¥30,000/月）
Supabase: $25 x 10 = $250/月（約 ¥37,500/月）
合計: $450/月（約 ¥67,500/月）

【収支】
収入: ¥20,000 x 10 = ¥200,000/月
支出: ¥67,500/月
利益: ¥132,500/月
```

#### オプション2: 1つのProアカウントで管理

```
【コスト】
Vercel: $20/月（約 ¥3,000/月）
Supabase: $25 x 10 = $250/月（約 ¥37,500/月）
合計: $270/月（約 ¥40,500/月）

【注意】
帯域幅: 1TB/月を10社で共有（1社あたり100GB/月）
→ 超過する可能性が高い

【収支】
収入: ¥15,000 x 10 = ¥150,000/月
支出: ¥40,500/月
利益: ¥109,500/月

※ただし、帯域幅超過のリスクあり
```

---

## 顧客への請求方法

### 月額料金の内訳（例）

```
【顧客への請求: ¥20,000/月】

内訳:
├── インフラ費用
│   ├── Vercel Pro: ¥3,000/月
│   └── Supabase Pro: ¥3,750/月
│   小計: ¥6,750
│
├── サポート・保守費用
│   ├── アプリ保守: ¥5,000/月
│   ├── 機能追加対応: ¥3,000/月
│   └── 問い合わせ対応: ¥2,000/月
│   小計: ¥10,000
│
└── 利益
    └── あなたの利益: ¥3,250/月

合計: ¥20,000/月
```

### 請求書テンプレート

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
請求書
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

請求先: 株式会社○○○○ 様
請求日: 2025年12月1日
対象期間: 2025年12月分

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
サービス内容
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1. 日報管理システム 月額利用料

   【基本料金】
   ・システム利用料              ¥10,000
   ・インフラ費用（Vercel）      ¥3,000
   ・データベース費用（Supabase） ¥3,750

   【サポート・保守】
   ・システム保守費用             ¥2,000
   ・問い合わせ対応               ¥1,250

   ━━━━━━━━━━━━━━━━━━━━━━━━━━
   小計                          ¥20,000
   消費税（10%）                  ¥2,000
   ━━━━━━━━━━━━━━━━━━━━━━━━━━
   合計                          ¥22,000

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
お支払い方法: 銀行振込
振込先: ○○銀行 ○○支店 普通 1234567
お支払期限: 2025年12月20日
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

### 価格設定のポイント

1. **インフラ費用を明示する**
   - 顧客はコストが見えるので納得しやすい
   - Vercel/Supabase の料金を上乗せできる

2. **サポート・保守費用を分ける**
   - あなたの労働対価として正当化
   - 機能追加は別料金にできる

3. **利益を適切に確保する**
   - 最低でも20〜30%の利益率を確保
   - 緊急対応・トラブル対応の余裕を持つ

### 契約形態

#### パターン1: サブスクリプション契約

```
月額料金: ¥20,000/月
契約期間: 1年間（自動更新）
支払い方法: 毎月払い
解約: 1ヶ月前通知
```

#### パターン2: 初期費用 + 月額

```
初期費用: ¥100,000（セットアップ・導入支援）
月額料金: ¥15,000/月
契約期間: 1年間
```

#### パターン3: 年払い割引

```
月額払い: ¥20,000/月 x 12 = ¥240,000/年
年払い: ¥220,000/年（約8%割引）
```

---

## デプロイ手順

### 前提条件

- Node.js がインストール済み
- Git がインストール済み
- GitHub アカウントを持っている
- プロジェクトが GitHub にプッシュ済み

### ステップ1: Vercel CLI のインストール

```bash
# グローバルにインストール（初回のみ）
npm install -g vercel

# または、npx で都度実行（インストール不要）
npx vercel
```

### ステップ2: Vercel にログイン

```bash
npx vercel login
```

ブラウザが開き、以下の方法でログインできます：
- GitHub
- GitLab
- Bitbucket
- Email

### ステップ3: プロジェクトをデプロイ（プレビュー）

```bash
# プロジェクトディレクトリに移動
cd /Users/Uni/Uni_MacBookAir/アプリ制作/日報アプリ/web

# プレビューデプロイ
npx vercel
```

**対話形式で質問されます**:

```
? Set up and deploy "~/日報アプリ/web"? [Y/n] y
? Which scope do you want to deploy to? Your Name
? Link to existing project? [y/N] n
? What's your project's name? daily-report
? In which directory is your code located? ./
? Auto-detected Project Settings (Next.js):
- Build Command: next build
- Development Command: next dev --port $PORT
- Install Command: npm install
- Output Directory: .next
? Want to modify these settings? [y/N] n
```

**デプロイが完了すると**:

```
✅ Preview: https://daily-report-xxxxx.vercel.app
```

### ステップ4: 環境変数の設定

Vercel ダッシュボードで環境変数を設定します。

#### 方法1: Vercel ダッシュボード（推奨）

1. https://vercel.com/dashboard にアクセス
2. プロジェクト（daily-report）を選択
3. "Settings" → "Environment Variables" をクリック
4. 以下の環境変数を追加：

```
Name: DATABASE_URL
Value: postgresql://postgres:password@db.xxx.supabase.co:5432/postgres
Environment: Production, Preview, Development ← すべてチェック

Name: JWT_SECRET
Value: your-secret-key-32-chars-minimum
Environment: Production, Preview, Development

Name: NEXT_PUBLIC_SUPABASE_URL
Value: https://xxx.supabase.co
Environment: Production, Preview, Development

Name: NEXT_PUBLIC_SUPABASE_ANON_KEY
Value: your-anon-key
Environment: Production, Preview, Development
```

#### 方法2: Vercel CLI（上級者向け）

```bash
# 環境変数を設定
npx vercel env add DATABASE_URL production
# プロンプトで値を入力

npx vercel env add JWT_SECRET production
npx vercel env add NEXT_PUBLIC_SUPABASE_URL production
npx vercel env add NEXT_PUBLIC_SUPABASE_ANON_KEY production
```

### ステップ5: 本番環境へデプロイ

```bash
# 本番デプロイ
npx vercel --prod
```

**デプロイが完了すると**:

```
✅ Production: https://daily-report.vercel.app
```

### ステップ6: 初回セットアップ

```bash
# ブラウザで以下にアクセス
https://daily-report.vercel.app/setup

# スーパーアドミンを作成
- 社員番号: ADMIN001
- 社員名: システム管理者
- パスワード: ********
```

### ステップ7: 動作確認

以下の機能をテストします：

- [ ] ログイン機能
- [ ] 日報作成・編集・削除
- [ ] 検索・フィルター機能
- [ ] 管理者機能（社員管理、操作ログ）
- [ ] レスポンシブデザイン（スマホで確認）

### ステップ8: カスタムドメインの設定（オプション）

Vercel ダッシュボードでカスタムドメインを設定できます：

1. "Settings" → "Domains"
2. "Add Domain" をクリック
3. ドメイン名を入力（例: daily-report.example.com）
4. DNS レコードを設定（Vercel が指示してくれます）

---

## 推奨アプローチ

### フェーズ1: デモ環境の構築（無料）

**目的**: 顧客にデモを見せる、動作確認

```bash
# Hobby プラン（無料）でデプロイ
npx vercel

# デモURL
https://daily-report-demo.vercel.app

# 用途:
- 顧客へのデモ
- 開発・テスト
- 機能の動作確認
```

**料金**: $0/月

### フェーズ2: 最初の顧客（1〜3社）

**目的**: 本番環境の構築

```bash
# オプション1: 各顧客にProアカウント（推奨）
顧客A: Vercel Pro ($20/月)
顧客B: Vercel Pro ($20/月)
顧客C: Vercel Pro ($20/月)

# オプション2: 1つのProアカウントで管理（コスト重視）
あなた: Vercel Pro ($20/月)
└── 顧客A, B, C のプロジェクト
```

**料金**:
- オプション1: $60/月（約 ¥9,000/月）
- オプション2: $20/月（約 ¥3,000/月）

**推奨**: 最初の3社まではオプション2でコスト削減、それ以降はオプション1

### フェーズ3: スケールアップ（4社以上）

**目的**: セキュリティとスケーラビリティの確保

```bash
# 各顧客にProアカウント（必須）
顧客A: Vercel Pro ($20/月)
顧客B: Vercel Pro ($20/月)
...
顧客N: Vercel Pro ($20/月)
```

**理由**:
- セキュリティの分離
- 帯域幅の制限回避
- 顧客ごとの独立性

---

## よくある質問

### Q1: Hobby プランで商用利用するとバレる？

**A**: Vercel の利用規約違反です。アカウント停止のリスクがあります。

Vercel は以下の方法で商用利用を検知する可能性があります：
- トラフィックパターン
- 帯域幅の使用量
- ドメイン名（company.com など）
- サポート問い合わせの内容

**推奨**: 商用利用は必ず Pro プランを使用してください。

### Q2: 1つのProアカウントで何個までプロジェクトを作成できる？

**A**: 無制限です。

ただし、以下の制限を考慮してください：
- 帯域幅: 1TB/月（全プロジェクト合計）
- 同時ビルド: 12個まで
- Edge Functions: 1,000,000リクエスト/日（全プロジェクト合計）

### Q3: 顧客が増えたらEnterprise プランにすべき？

**A**: 顧客数だけでなく、以下の要素で判断してください：

**Enterprise プランが必要な場合**:
- 顧客数が50社以上
- 専任サポートが必要
- カスタムSLA（稼働率保証）が必要
- より高い帯域幅・ビルド時間が必要

**Pro プランで十分な場合**:
- 顧客数が50社未満
- 各顧客に個別のProアカウントを作成できる

### Q4: デプロイに失敗した場合は？

**A**: 以下を確認してください：

1. **ビルドエラー**:
   ```bash
   # ローカルでビルドを確認
   npm run build
   ```

2. **環境変数の設定**:
   - Vercel ダッシュボードで環境変数が正しく設定されているか確認

3. **ログの確認**:
   - Vercel ダッシュボード → Deployments → 失敗したデプロイ → Logs

4. **Prisma のエラー**:
   ```bash
   # Prisma Client を再生成
   npx prisma generate
   git add prisma/
   git commit -m "Update Prisma Client"
   git push
   ```

### Q5: デプロイ後にデータベースに接続できない

**A**: 以下を確認してください：

1. **DATABASE_URL の確認**:
   - Vercel ダッシュボードで環境変数が設定されているか
   - 値が正しいか（コピー&ペーストミスがないか）

2. **Supabase の接続制限**:
   - Supabase ダッシュボード → Settings → Database
   - Connection pooling が有効か確認
   - Vercel の IP アドレスが許可されているか

3. **接続文字列の形式**:
   ```
   正しい形式:
   postgresql://postgres:password@db.xxx.supabase.co:5432/postgres

   間違った形式:
   postgresql://postgres@db.xxx.supabase.co:5432/postgres
   （パスワードが抜けている）
   ```

---

## まとめ

### デプロイ先の選択

✅ **Vercel を推奨**

**理由**:
1. Next.js + Prisma が確実に動く
2. セットアップが超簡単（15分）
3. 商用利用は Pro プラン（$20/月）で可能
4. 顧客への月額料金に含めれば問題なし

### 複数顧客への提供方法

✅ **各顧客に Pro アカウント（推奨）**

**理由**:
1. セキュリティが高い
2. スケーラビリティがある
3. 顧客が自分で管理できる
4. 料金を顧客に転嫁できる

### 料金設定

✅ **月額 ¥15,000〜20,000/社**

**内訳**:
- Vercel Pro: ¥3,000
- Supabase Pro: ¥3,750
- サポート・保守: ¥10,000
- 利益: ¥3,000〜8,000

### 次のステップ

1. **今すぐ**: Hobby プラン（無料）でデプロイしてデモ環境を構築
2. **顧客獲得後**: Pro プラン（$20/月）で本番環境を構築
3. **スケールアップ**: 各顧客に個別の Pro アカウントを作成

---

## 参考リンク

- [Vercel 公式ドキュメント](https://vercel.com/docs)
- [Vercel 料金プラン](https://vercel.com/pricing)
- [Next.js デプロイガイド](https://nextjs.org/docs/app/building-your-application/deploying)
- [Prisma with Vercel](https://www.prisma.io/docs/guides/deployment/deployment-guides/deploying-to-vercel)
