# 日報アプリ 検索・フィルター機能 提案書

## 📋 現在の実装状況

### 管理者側（/admin）

- ✅ 社員でのフィルター（ドロップダウン選択）
- ✅ 日付範囲でのフィルター（開始日・終了日）
- ⚠️ 基本的なフィルターのみ、検索機能なし

### 社員側（/）

- ❌ 検索・フィルター機能なし
- ✅ 自分の日報一覧のみ表示

---

## 🎯 提案する機能

### 1. **キーワード検索機能** ⭐️ 高優先度

#### 検索対象フィールド

- **日報の基本情報**

  - 本日の目標（dailyGoal）
  - 改善点・気づき（improvements）
  - 嬉しかったこと・感動したこと（happyMoments）
  - これからのタスク（futureTasks）

- **活動セクション**
  - プロジェクト/カテゴリー（projectCategory）
  - 活動内容（content）
  - 課題（issues）

#### 実装方法

- **フロントエンド検索**: 既に取得したデータをクライアント側でフィルタリング
- **バックエンド検索**: データベースで LIKE 検索（大規模データに対応）

#### 表示方法

- 検索結果のハイライト表示
- 検索結果件数の表示
- 「検索結果が見つかりません」メッセージ

---

### 2. **プロジェクト/カテゴリーでのフィルター** ⭐️ 高優先度

#### 機能概要

- 活動セクションの「プロジェクト/カテゴリー」でフィルタリング
- 複数選択可能なマルチセレクト形式

#### 実装案

- ドロップダウンまたはチェックボックス形式
- 管理者側：全社員の全プロジェクトから選択
- 社員側：自分の使用しているプロジェクトのみ表示

#### ユースケース

- 「プロジェクト A」に関連する日報のみ表示
- 複数プロジェクトを同時にフィルター

---

### 3. **稼働時間でのフィルター** ⭐️ 中優先度

#### フィルター条件

- **最小稼働時間**: 指定時間以上の日報のみ
- **最大稼働時間**: 指定時間以下の日報のみ
- **範囲指定**: 最小〜最大の範囲でフィルター

#### 表示

- スライダーまたは数値入力フォーム
- フィルター適用後の平均稼働時間表示

---

### 4. **並び替え機能** ⭐️ 中優先度

#### 並び替えオプション

**日付関連**

- 日付（新しい順）← 現在のデフォルト
- 日付（古い順）
- 更新日時（新しい順）
- 更新日時（古い順）

**稼働時間**

- 稼働時間（多い順）
- 稼働時間（少ない順）

**その他**

- 活動数（多い順）
- 活動数（少ない順）

#### 実装

- ドロップダウンで並び替え方法を選択
- 即座に反映（リアルタイムソート）

---

### 5. **期間のクイック選択** ⭐️ 中優先度

#### プリセット期間

- 今日
- 昨日
- 今週（月曜日〜日曜日）
- 先週
- 今月
- 先月
- 今四半期（3 ヶ月）
- 今年
- カスタム期間（開始日・終了日を手動入力）

#### 実装

- ボタンまたはタブ形式で期間を選択
- 選択後、開始日・終了日フィールドに自動入力

---

### 6. **高度な検索（複合条件）** ⭐️ 低優先度

#### 機能概要

- 複数の条件を組み合わせて検索
- AND/OR 条件の選択
- 保存した検索条件（お気に入り検索）

#### 条件例

- 「プロジェクト A」かつ「稼働時間 5 時間以上」
- 「キーワード"テスト"」または「キーワード"デバッグ"」

---

## 📱 実装優先度

### フェーズ 1（基本機能）✨ 最優先

1. **キーワード検索機能**

   - 社員側・管理者側両方に実装
   - フロントエンド検索で開始

2. **プロジェクト/カテゴリーフィルター**

   - 管理者側：全プロジェクト一覧から選択
   - 社員側：自分のプロジェクトのみ

3. **並び替え機能**
   - 日付・稼働時間・更新日時での並び替え

### フェーズ 2（拡張機能）

4. **期間のクイック選択**

   - 管理者側・社員側両方

5. **稼働時間フィルター**
   - 管理者側のみ（分析目的）

### フェーズ 3（高度な機能）

6. **高度な検索（複合条件）**
   - 管理者側のみ

---

## 🎨 UI/UX 提案

### 検索バー

```
[🔍 キーワード検索...] [検索]
```

### フィルターエリア（管理者側）

```
┌─────────────────────────────────────────┐
│ フィルター                              │
├─────────────────────────────────────────┤
│ キーワード: [____________] [検索]      │
│                                         │
│ 社員: [全社員 ▼]                       │
│                                         │
│ 期間: [今月 ▼] または                  │
│      開始日: [____] 終了日: [____]    │
│                                         │
│ プロジェクト: [複数選択... ▼]         │
│                                         │
│ 並び替え: [日付（新しい順）▼]         │
│                                         │
│ [フィルター適用] [リセット]            │
└─────────────────────────────────────────┘
```

### フィルターエリア（社員側）

```
┌─────────────────────────────────────────┐
│ 検索・フィルター                        │
├─────────────────────────────────────────┤
│ 🔍 [キーワード検索...] [検索]          │
│                                         │
│ プロジェクト: [プロジェクトA, B... ▼] │
│                                         │
│ 並び替え: [日付（新しい順）▼]         │
│                                         │
│ [リセット]                              │
└─────────────────────────────────────────┘
```

---

## 💾 データベース検討事項

### インデックス追加（検索性能向上）

- `daily_reports.dailyGoal` への全文検索インデックス（PostgreSQL）
- `activities.projectCategory` へのインデックス（既存）
- `activities.content` への全文検索インデックス

### 検索方法

1. **フロントエンド検索（初期実装）**

   - 既存の API で全データを取得
   - クライアント側でフィルタリング
   - 実装が簡単、データ量が少ない場合に有効

2. **バックエンド検索（拡張時）**
   - Prisma の`contains`や`search`を使用
   - PostgreSQL の全文検索機能活用
   - データ量が多い場合に必要

---

## 📊 実装例（疑似コード）

### キーワード検索（フロントエンド）

```typescript
const filteredReports = reports.filter((report) => {
  const keyword = searchKeyword.toLowerCase();

  // 日報の基本情報を検索
  const matchesBasicInfo =
    report.dailyGoal.toLowerCase().includes(keyword) ||
    report.improvements.toLowerCase().includes(keyword) ||
    report.happyMoments.toLowerCase().includes(keyword) ||
    report.futureTasks.toLowerCase().includes(keyword);

  // 活動セクションを検索
  const matchesActivities = report.activities.some(
    (activity) =>
      activity.projectCategory.toLowerCase().includes(keyword) ||
      activity.content.toLowerCase().includes(keyword) ||
      activity.issues.toLowerCase().includes(keyword)
  );

  return matchesBasicInfo || matchesActivities;
});
```

### プロジェクトフィルター

```typescript
const filteredReports = reports.filter((report) => {
  if (selectedProjects.length === 0) return true;

  return report.activities.some((activity) =>
    selectedProjects.includes(activity.projectCategory)
  );
});
```

---

## 🔄 既存機能との統合

### 管理者側

- 既存の「社員」「開始日」「終了日」フィルターと統合
- 新しいフィルター条件を追加
- すべての条件を AND 条件で結合

### 社員側

- 新しい検索・フィルター機能を追加
- シンプルで使いやすい UI

---

## 📝 まとめ

### 推奨実装順序

1. **社員側の基本検索・フィルター**（フェーズ 1）

   - キーワード検索
   - プロジェクトフィルター
   - 並び替え

2. **管理者側の検索機能強化**（フェーズ 1）

   - キーワード検索
   - プロジェクトフィルター
   - 既存フィルターとの統合

3. **期間クイック選択**（フェーズ 2）

   - 管理者側・社員側両方

4. **高度な機能**（フェーズ 3）
   - 稼働時間フィルター
   - 複合条件検索

---

## ❓ 確認事項

1. **検索範囲**: どのフィールドを検索対象にするか？
2. **検索方法**: フロントエンド検索 or バックエンド検索？
3. **優先度**: どの機能から実装を開始するか？
4. **UI**: シンプルな検索バー or 詳細なフィルターパネル？
